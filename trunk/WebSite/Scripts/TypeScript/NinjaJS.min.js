var NinjaJS=function(){var n=function(n,t){var i=n.getContainerPosition(),r=_.map(t.touches,function(t){var r=(t.clientX-i.left+window.pageXOffset)*n.resizeRatio,u=(t.clientY-i.top+window.pageYOffset)*n.resizeRatio;return{x:r,y:u,identifier:t.identifier}}),u,f;return r.length>0?r:(u=(t.clientX-i.left+window.pageXOffset)*n.resizeRatio,f=(t.clientY-i.top+window.pageYOffset)*n.resizeRatio,[{x:u,y:f,identifier:"mouse"}])},i=function(t){var r=function(i){var o,e,f,r,u,s;for(i.preventDefault(),o=n(t,i),e=[],f=t.shapes.length-1;f>=0;f--)(r=t.shapes[f],u=_.first(_.filter(o,function(n){return r.isPointInPath(n.x,n.y)})),u==null||_.include(e,u))||(s=r.isDragging(),r.dragPoint=u,e.push(u),!s&&r.isDragging()&&(i.userPosition=u,r.trigger("dragstart",i)))},u=function(i){i.preventDefault();var u=n(t,i),r=!1;_.each(t.shapes,function(n){var t,f,e;n.isDragging()&&(t=_.find(u,function(t){return t.identifier===n.dragPoint.identifier}),t!=null)&&(f=n.dragX?t.x-n.dragPoint.x:0,e=n.dragY?t.y-n.dragPoint.y:0,(f!=0||e!=0)&&(n.move(f,e),i.userPosition=t,n.isMoving=!0,i.draggedX=f,i.draggedY=e,n.trigger("dragmove",i),n.dragPoint=t,r=!0))}),r&&t.draw()},f=function(i){i.preventDefault();var r=n(t,i);_.each(t.shapes,function(n){if(n.isDragging()){var t=_.find(r,function(t){return t.identifier===n.dragPoint.identifier});i.touches&&t!=null||(i.userPosition=n.dragPoint,n.dragPoint=null,n.isMoving=!1,n.trigger("dragend",i))}})},h=function(i){var r=n(t,i);_.each(t.shapes,function(n){var t=_.any(r,function(t){return n.isPointInPath(t.x,t.y)});t?(n.isMousedOver=!0,n.trigger("mouseover",i)):n.isMousedOver&&!t&&(n.isMousedOver=!1,n.trigger("mouseout",i))})},i=function(i){return function(r){r.preventDefault();var u=n(t,r);_.each(t.shapes,function(n){if(!n.draggable){var t=_.first(_.filter(u,function(t){return n.isPointInPath(t.x,t.y)}));t!=null&&(r.userPosition=t,n.trigger(i,r))}})}},e=function(i){var f,u,r;for(i.preventDefault(),f=n(t,i),u=[],r=t.shapes.length-1;r>=0;r--)(function(n){var i=t.shapes[n],r;i.isMoving||(r=_.first(_.filter(f,function(n){return i.isPointInPath(n.x,n.y)})),r==null||_.include(u,r))||(i.taps||(i.taps=[]),i.taps.push(r),u.push(r),setTimeout(function(){i.taps=[]},300))})(r)},o=function(n){n.preventDefault(),_.each(t.shapes,function(n){n.taps=[]})},s=function(n){n.preventDefault(),_.each(t.shapes,function(t){t.taps&&t.taps.length>0&&(n.taps=t.taps,n.userPosition=_.last(n.taps),t.trigger("tap",n))})},c=function(i){i.preventDefault();var r=n(t,i);_.each(t.shapes,function(n){if(!n.isMoving){var t=_.first(_.filter(r,function(t){return n.isPointInPath(t.x,t.y)}));t!=null&&(i.userPosition=t,n.trigger("click",i))}})};t.canvas.addEventListener("touchstart",r,!1),t.canvas.addEventListener("touchmove",u,!1),t.canvas.addEventListener("touchend",f,!1),t.canvas.addEventListener("mousedown",r,!1),t.canvas.addEventListener("mousemove",u,!1),t.canvas.addEventListener("mouseup",f,!1),t.canvas.addEventListener("touchstart",i("inputstart"),!1),t.canvas.addEventListener("touchmove",i("inputmove"),!1),t.canvas.addEventListener("touchend",i("inputend"),!1),t.canvas.addEventListener("mousedown",i("inputstart"),!1),t.canvas.addEventListener("mousemove",i("inputmove"),!1),t.canvas.addEventListener("mouseup",i("inputend"),!1),t.canvas.addEventListener("touchstart",e,!1),t.canvas.addEventListener("touchmove",o,!1),t.canvas.addEventListener("touchend",s,!1),t.canvas.addEventListener("mousedown",e,!1),t.canvas.addEventListener("mousemove",o,!1),t.canvas.addEventListener("mouseup",s,!1),t.canvas.addEventListener("mousemove",h,!1),t.canvas.addEventListener("click",c,!1)},t=function(n,t,i){var r=t/n.width,u=i/n.height;return function(){return r<=u?r:u}()},r=function(n,i,r){var u=t(n,i,r);return{width:Math.round(n.width*u),height:Math.round(n.height*u)}},u=function(n){for(var t,i=arguments,r=i.length,u;r>1&&n.length;)for(t=i[--r];(u=n.indexOf(t))!=-1;)n.splice(u,1);return n},f=function(){return function(n,f,e,o,s){var h=this;this.container=n,this.canvas=document.createElement("canvas"),this.canvas.width=f,this.canvas.height=e,this.context=this.canvas.getContext("2d"),this.width=f,this.height=e,this.shapes=[],this.maxZ=0,this.resizeRatio=1,this.container.appendChild(this.canvas),this.add=function(n){n.stage=h,n.z=h.maxZ+1,h.maxZ=n.z,this.shapes.push(n)},this.remove=function(n){u(this.shapes,n)},this.reorder=function(){h.shapes.sort(function(n,t){return n.z-t.z})},this.getContainerPosition=function(){for(var t=0,i=0,n=h.canvas;n&&!isNaN(n.offsetLeft)&&!isNaN(n.offsetTop);)t+=n.offsetLeft-n.scrollLeft,i+=n.offsetTop-n.scrollTop,n=n.offsetParent;return{top:i,left:t}},this.clear=function(){var t=h.context,n=h.canvas;t.clearRect(0,0,n.width,n.height)},this.draw=function(){setTimeout(function(){h.clear(),h.reorder(),h.shapes.forEach(function(n){n.draw()})},0)},this.resizeCanvas=function(n,i){var u=r({width:h.canvas.width,height:h.canvas.height},n,i);h.resizeRatio=1/t({width:h.canvas.width,height:h.canvas.height},n,i),h.canvas.style.width=u.width+"px",h.canvas.style.height=u.height+"px"},i(h),o&&s&&h.resizeCanvas(o,s)}}(),e=function(){return function(n){var t=this;this.visible=!0,this.drawFunc=n,this.x=0,this.y=0,this.z=0,this.scale=1,this.taps=0,this.events={},this.dragPoint=null,this.draggable=!1,this.dragX=!0,this.dragY=!0,this.rotation=0,this.isDragging=function(){return t.draggable===!1?!1:t.dragPoint!=null},this.getCanvas=function(){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas},this.getContext=function(){return t.context||(t.context=t.canvas.getContext("2d")),t.context},this.redraw=function(){this.canvas=document.createElement("canvas"),this.context=t.canvas.getContext("2d"),this.drawFunc.call(t)},this.draw=function(){if(t.visible){var i=t.stage.context,n=t.getCanvas();i.save(),(t.x!==0||t.y!==0)&&i.translate(t.x,t.y),i.drawImage(n,0,0,n.width,n.height,0,0,n.width,n.height),i.restore()}},this.animateTo=function(){var n=!1;return function(i,r,u){var s=t,f,e;if(n!==!0&&(f=i-s.x,e=r-s.y,f!==0||e!==0)){var o=4,h=f<0?Math.ceil(f/o):Math.floor(f/o),c=e<0?Math.ceil(e/o):Math.floor(e/o);h===0&&(h=f),c===0&&(c=e),n=!0,setTimeout(function(){n=!1,s.move(h,c),u&&u(),t.stage.draw(),t.animateTo(i,r,u)},1e3/60)}}}(),this.bind=function(n,i){var r=t.events[n];r||(r=[],t.events[n]=r),r.push(i)},this.trigger=function(n,i){var u=t.events[n],r;if(u)for(r=0;r<u.length;r++)u[r](i)},this.unbind=function(n){var i=t.events[n];i&&delete t.events[n]},this.setPosition=function(n,i){t.x=n,t.y=i},this.isPointInPath=function(n,i){var r={x:n-this.x,y:i-this.y};return t.getContext().isPointInPath(r.x,r.y)},this.moveToTop=function(){t.z=t.stage.maxZ+1,t.stage.maxZ=t.z,t.stage.reorder()},this.move=function(n,i){t.x+=n,t.y+=i},this.redraw()}}();return{Stage:f,Shape:e}}()